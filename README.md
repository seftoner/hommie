# Hommie - Flutter client for HomeAssistant
This project aims to create a beautiful client app for Home Assistant (HA) using Dart and Flutter. The client communicates with the Home Assistant instance via WebSocket API

## Motivation
The motivation behind this project is to create a visually appealing and user-friendly client app for Home Assistant that can run on various platforms.

I also love practicing programming and exploring new technologies, making this pet project both a learning experience and a source of fun for me.

## Featueres
Currently, there are not many of them. I want to design a good architecture (skeleton), so I can easily add new features (muscles).
I want to add 'Companion App' functionality in the near future.

- **Authentication**: Users can authenticate and log out securely. This feature has been tested only on a local network.
  - Server Discovery: Automatically discovers available Home Assistant servers on the user’s local network, displaying them as a list for easy selection during authentication.
- **Areas**: List of areas
- **Companion App**: (In Progress): This feature will allow the app to register on the Home Assistant server and send location and other sensor data.
- **Logs**: Users can view, and export logs generated by the app.

### Platforms
1. iOS - ✅
2. MacOS - ✅
3. Android - ✅
4. Windows - ⚠️(Not tested)
5. Linux ⚠️(Not tested)

## Build & Run
1. Get dependencies `flutter pub get` 
2. Run build_runer `dart run build_runner watch`

> [!TIP]
> VS Code users can use keyboard shortcut:
> - macOS: `Cmd + Shift + P`, then type "Tasks: Run Build Task"
> - Windows/Linux: `Ctrl + Shift + P`, then type "Tasks: Run Build Task"
>   
> Select `flutter: build_runner watch` from the task list.

## Testing Setup & Execution

### 1. Setup Home Assistant Test Instance
Before running tests, you need a Home Assistant instance:

1. Navigate to the docker directory
2. Run `docker compose up`
3. Access Home Assistant at `http://localhost:8123`

Default credentials:
- Username: `admin`
- Password: `yourpassword`

> [!NOTE]
> Make sure you have Docker installed on your system.

#### Docker Instance Details
After first startup:
- A `.initialized` file will be created in `docker/hass_init_conf/` directory
  - This file prevents reconfiguration of HA server on subsequent runs
- An `.env` file will be created with two important variables:
  ```properties
  HASS_SERVER=http://localhost:8123
  HASS_TOKEN=your_long_lived_access_token
  ```

#### Configure Patrol Tests
Before running integration tests:
1. Copy the `HASS_TOKEN` value from `docker/hass_init_conf/.env`
2. Create or edit `.patrol.env` in project root:
   ```properties
   HASS_TOKEN=your_long_lived_access_token
   ```

> [!IMPORTANT]
> Integration tests will fail without proper token configuration in `.patrol.env`

### 2. Setup Patrol CLI
1. Install Patrol CLI:
```bash
dart pub global activate patrol_cli
```

2. Install platform-specific dependencies:
```bash
patrol doctor
```

### 3. Run Integration Tests

You can run tests in two ways:

#### Using VS Code
You can run tests in two ways:
- Open Command Palette (`Cmd/Ctrl + Shift + P`), type "Tasks: Run Test Task", and select `patrol: run tests`

#### Using Command Line
Regular test run:
```bash
patrol test
```

Development mode:
```bash
patrol develop -d "<your device name>" -t --watch integration_test/your_test.dart
```

> [!IMPORTANT]
> Always ensure Home Assistant docker container is running before executing tests.

## Contribution
Contributions to this project are welcome! If you'd like to contribute, please fork the repository, make your changes, and submit a pull request. You can also open an issue to report bugs or suggest new features.

## License
This project is licensed under the [MIT License](LICENSE.txt)
